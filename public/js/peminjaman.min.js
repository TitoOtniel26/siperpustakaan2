$(document).ready(function () {
    minTanggal('tglawal');
    minTanggal('tglakhir');
})

$('#id_buku').on('change', function () {
    let kodebuku = $('#id_buku option:selected').attr('kodebuku');

    let arrkodebukutbody = [];
    $('.kode_buku_tbody').each(function () {
        let kodebukutbody = $(this).val();
        arrkodebukutbody.push(kodebukutbody);
    })

    if (arrkodebukutbody.includes(kodebuku)) {
        alert("Buku Yang Dipilih Sudah Ada!")
    }
    else {
        $.ajax({
            type: "POST",
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            },
            data: { kodebuku },
            dataType: "JSON",
            url: base_url + "/peminjaman/getdatabuku",
            success: function (res) {
                let c = ``;
                $.map(res, function (i) {
                    c += `
                    <tr id="trbuku`+ kodebuku + `">
                        <td>
                            <input type="hidden" name="kodebuku[]" class="kode_buku_tbody" value="`+ i.kode_buku + `">
                        `+ i.kode_buku + `</td>
                        <td>`+ i.judul_buku + `</td>
                        <td>`+ i.penerbit + `</td>
                        <td>`+ i.pengarang + `</td>
                        <td>`+ i.nama_kategori + `</td>
                        <td>`+ i.namarak + `</td>
                        <td>
                            <button type="button" class="btn btn-danger btn-md btnhapustbodybuku" idhapus="trbuku`+ kodebuku + `"><i class="fa fa-trash"></i></button>
                        </td>
                    </tr>
                `
                })
                $('#tbodypeminjaman').append(c);
            }
        })
        $('#id_buku option:selected').prop('selected', false);
    }
});

$(document).on('click', '.btnhapustbodybuku', function () {
    let idhapus = $(this).attr('idhapus');
    $('#' + idhapus).remove();
});

$('.btnhapus').on('click', function (e) {
    let textconfirm = confirm("Are you sure you want to delete this item?");

    if (textconfirm == true) {
        return true;
    }
    else {
        return false;
    }
});



